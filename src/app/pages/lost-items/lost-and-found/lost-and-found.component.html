<div></div>
<div class="title-container">
  <div class="line"></div>
  <p class="title">Objetos Perdidos</p>
  <div class="line"></div>
</div>
<div class="container-fluid">
  <div class="row">
    <div class="col col-2"></div>

    <div class="col col-3">
      <mat-form-field class="custom-form-field" appearance="outline">
        <mat-label>Filtrar</mat-label>
        <input
          matInput
          (keyup)="applyFilter($event)"
          placeholder="Ej. ium"
          #input
        />
        <button mat-icon-button matSuffix>
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <div class="col col-3" style="margin-top: 60px">
      <div class="container-fluid">
        <div class="row d-flex">
          <div style="font-size: 14px; margin: 0" class="col-12 col-md-4 p-0">
            <label for="estado">Estado objeto:</label>
          </div>
          <div style="font-size: 14px; margin: 0" class="col-12 col-md-4 p-0">
            <input
              type="radio"
              id="sin-entregar"
              name="estado"
              value="sin-entregar"
            />
            <label for="sin-entregar"> &nbsp;Sin Entregar</label>
          </div>
          <div style="font-size: 14px; margin: 0" class="col-12 col-md-4 p-0">
            <input
              type="radio"
              id="entregado"
              name="estado"
              value="entregado"
            />
            <label for="entregado"> &nbsp;Entregado</label>
          </div>
        </div>
      </div>
    </div>

    <div class="col col-2 d-flex justify-content-end">
      <button
        type="button"
        class="btn btn-agregar w-100"
        data-bs-toggle="modal"
        data-bs-target="#addModal"
        [disabled]="!canCreate"
        [ngClass]="{ 'disabled-button': !canCreate }"
      >
        Agregar
      </button>
    </div>

    <div class="col col-2"></div>
  </div>
</div>

<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-md-8 col-sm-12">
      <div class="table-responsive">
        <table
          mat-table
          [dataSource]="dataSource"
          class="mat-elevation-z8"
          style="text-align: center; width: 100%"
        >
          <ng-container matColumnDef="name">
            <th
              mat-header-cell
              *matHeaderCellDef
              style="background-color: #89c1e0"
            >
              <p style="color: black; text-align: center">Artículo</p>
            </th>
            <td mat-cell *matCellDef="let element" class="fixed-width">
              {{ element.name }}
            </td>
          </ng-container>

          <ng-container matColumnDef="description">
            <th
              mat-header-cell
              *matHeaderCellDef
              style="background-color: #89c1e0"
            >
              <p style="color: black; text-align: center">Descripción</p>
            </th>
            <td mat-cell *matCellDef="let element" class="fixed-width">
              {{ element.description }}
            </td>
          </ng-container>

          <ng-container matColumnDef="category">
            <th
              mat-header-cell
              *matHeaderCellDef
              style="background-color: #89c1e0"
            >
              <p style="color: black; text-align: center">Categoría</p>
            </th>
            <td mat-cell *matCellDef="let element">
              <ul style="list-style-type: none; padding: 0; margin: 0">
                <li
                  *ngIf="
                    element.category && element.category.length;
                    else noCategories
                  "
                >
                  <ng-container *ngFor="let category of element.category">
                    {{ capitalizeFirstLetter(category.category_name) }}
                  </ng-container>
                </li>
                <ng-template #noCategories> No disponible </ng-template>
              </ul>
            </td>
          </ng-container>

          <ng-container matColumnDef="safekeeper">
            <th
              mat-header-cell
              *matHeaderCellDef
              style="background-color: #89c1e0"
            >
              <p style="color: black; text-align: center">Encargado</p>
            </th>
            <td mat-cell *matCellDef="let element">
              <ul style="list-style-type: none; padding: 0; margin: 0">
                <li
                  *ngIf="
                    element.safekeeper && element.safekeeper.length;
                    else noSafekeeper
                  "
                >
                  <ng-container *ngFor="let safekeeper of element.safekeeper">
                    {{ safekeeper.email }}
                  </ng-container>
                </li>
                <ng-template #noSafekeeper> No disponible </ng-template>
              </ul>
            </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th
              mat-header-cell
              *matHeaderCellDef
              style="background-color: #89c1e0"
            >
              <p style="color: black; text-align: center">Estado</p>
            </th>
            <td mat-cell *matCellDef="let element" class="fixed-width">
              {{ element.status }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="clickable-row"
            (click)="openDialog(row)"
          ></tr>

          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="5">
              <p style="text-align: center; color: gray">
                No hay datos que coincidan con el filtro.
              </p>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>
<div
  class="modal fade"
  id="addModal"
  tabindex="-1"
  aria-labelledby="addModalLabel"
  aria-hidden="true"
  #addModal
>
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title w-100 text-center" id="addModalLabel">
          Agregar Objeto Perdido
        </h5>
      </div>
      <div class="modal-body">
        <div>
          <div class="mb-3">
            <label for="item-name" class="form-label"
              >Nombre del Artículo</label
            >
            <input
              type="text"
              class="form-control"
              id="item-name"
              [(ngModel)]="newObject.name"
            />
          </div>

          <div class="mb-2">
            <label for="item-image" class="form-label">Imagen</label>
            <input
              type="file"
              class="form-control"
              id="item-image"
              accept="image/*"
              (change)="previewImage($event)"
            />
            <div class="image-preview-container">
              <img
                id="image-preview"
                class="img-preview"
                [src]="imagePreviewUrl"
                alt="Vista previa de la imagen"
                *ngIf="imagePreviewUrl"
              />
              <button
                type="button"
                class="btn btn-danger mt-2 mb-2"
                (click)="removeImage()"
              >
                Eliminar imagen
              </button>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Categorías</label>
            <div class="categories-container">
              <div class="checkbox-group">
                <mat-checkbox
                  *ngFor="let category of categories"
                  [(ngModel)]="selectedCategories[category.category_name]"
                  (change)="onCategoryChange()"
                  class="categories-checkbox"
                >
                  <span class="categories-label">{{
                    category.category_name
                  }}</span>
                </mat-checkbox>
              </div>
              <mat-error
                *ngIf="!getSelectedCategories().length"
                class="categories-error"
              >
                Seleccione al menos una categoría.
              </mat-error>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Safekeepers</label>
            <div class="safekeepers-container">
              <div class="checkbox-group">
                <mat-checkbox
                  *ngFor="let safekeeper of safekeepers"
                  [(ngModel)]="selectedSafekeepers[safekeeper.email]"
                  (change)="onSafekeepersChange()"
                  class="safekeepers-checkbox"
                >
                  <span class="safekeepers-label">{{ safekeeper.name }}</span>
                </mat-checkbox>
              </div>
              <mat-error
                *ngIf="!getSelectedSafekeepers().length"
                class="safekeepers-error"
              >
                Seleccione al menos un encargado.
              </mat-error>
            </div>
          </div>

          <div class="mb-3">
            <label for="item-descripcion" class="form-label"
              >Descripción Detallada</label
            >
            <textarea
              class="form-control"
              id="item-descripcion"
              [(ngModel)]="newObject.description"
              rows="4"
            ></textarea>
          </div>

          <div class="mb-3">
            <label for="item-email" class="form-label">Email</label>
            <input
              type="text"
              class="form-control"
              id="item-email"
              [(ngModel)]="newObject.user_email"
            />
          </div>

          <div class="modal-footer">
            <div class="d-flex flex-wrap justify-content-between">
              <button
                type="button"
                style="background-color: #299980; color: aliceblue"
                class="btn btn-lg flex-grow-1 m-1"
                (click)="addLostObject()"
              >
                Agregar
              </button>
              <button
                type="button"
                class="btn btn-secondary btn-lg flex-grow-1 m-1"
                data-bs-dismiss="modal"
                (click)="closeModal()"
              >
                Cerrar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
